print("fucked by shadow")

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local MainWindow = Rayfield:CreateWindow({
   Name = "Shadow Hub | Mobile",
   Icon = 0,
   LoadingTitle = "Shadow Hub Loading...",
   LoadingSubtitle = "by Shadow",
   Theme = "Ocean", 
   ConfigurationSaving = { Enabled = true, FolderName = "ShadowHub", FileName = "config" },
   KeySystem = true, 
   KeySettings = {
      Title = "Shadow Hub | Key System",
      Subtitle = "Key is: main",
      Note = "Join the discord for keys",
      FileName = "ShadowKey", 
      SaveKey = true, 
      Key = {"main"}
   }
})

local MainTab = MainWindow:CreateTab("Main", 4483362458)
local CombatTab = MainWindow:CreateTab("Combat", 4483362458)

-- Services & Variables
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

-- Combat Settings
local AimlockEnabled = false
local TeamCheck = true
local LockPart = "Head"
local AimFOV = 150
local Smoothness = 0.5 -- New Smoothness variable
local CurrentTarget = nil

-- FOV Circle Visual
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.Color = Color3.fromRGB(0, 150, 255)
FOVCircle.Visible = false

-- TEAM CHECK FUNCTION
local function IsOnTeam(Player)
    if not TeamCheck then return false end
    if Player.Team == LocalPlayer.Team or Player.TeamColor == LocalPlayer.TeamColor then
        return true
    end
    return false
end

-- TARGETING FUNCTION
local function GetClosestToCursor()
    local Target = nil
    local ShortestDistance = AimFOV

    for _, Player in pairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character and Player.Character:FindFirstChild(LockPart) then
            local Hum = Player.Character:FindFirstChildOfClass("Humanoid")
            if not Hum or Hum.Health <= 0 then continue end
            if IsOnTeam(Player) then continue end

            local Pos, OnScreen = Camera:WorldToViewportPoint(Player.Character[LockPart].Position)
            
            if OnScreen then
                local MousePos = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
                local Distance = (Vector2.new(Pos.X, Pos.Y) - MousePos).Magnitude
                
                if Distance < ShortestDistance then
                    Target = Player
                    ShortestDistance = Distance
                end
            end
        end
    end
    return Target
end

-- COMBAT UI
CombatTab:CreateToggle({
   Name = "Aimlock (Chain Lock)",
   CurrentValue = false,
   Callback = function(Value)
       AimlockEnabled = Value
       FOVCircle.Visible = Value
       if not Value then CurrentTarget = nil end
   end,
})

CombatTab:CreateSlider({
   Name = "Aim Smoothness",
   Range = {0, 1},
   Increment = 0.1,
   CurrentValue = 0.5,
   Callback = function(Value)
       Smoothness = Value
   end,
})

CombatTab:CreateSlider({
   Name = "Aim FOV Radius",
   Range = {50, 800},
   Increment = 10,
   CurrentValue = 150,
   Callback = function(Value)
       AimFOV = Value
       FOVCircle.Radius = Value
   end,
})

CombatTab:CreateToggle({
   Name = "Team Check",
   CurrentValue = true,
   Callback = function(Value) 
       TeamCheck = Value 
       CurrentTarget = nil 
   end,
})

-- MAIN TAB (Movement)
local SpeedEnabled, WalkSpeedValue = false, 16
MainTab:CreateToggle({ Name = "Enable Speed", CurrentValue = false, Callback = function(V) SpeedEnabled = V end })
MainTab:CreateSlider({ Name = "Speed Amount", Range = {16, 500}, Increment = 1, CurrentValue = 16, Callback = function(V) WalkSpeedValue = V end })

-- MAIN LOOP
RunService.RenderStepped:Connect(function()
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    if AimlockEnabled then
        if CurrentTarget == nil or not CurrentTarget.Character or not CurrentTarget.Character:FindFirstChild(LockPart) or (CurrentTarget.Character:FindFirstChildOfClass("Humanoid") and CurrentTarget.Character.Humanoid.Health <= 0) or IsOnTeam(CurrentTarget) then
            CurrentTarget = GetClosestToCursor()
        end

        if CurrentTarget and CurrentTarget.Character and CurrentTarget.Character:FindFirstChild(LockPart) then
            -- The FIX: Interpolate CFrame for smoothness and direct vector calculation
            local TargetPos = CurrentTarget.Character[LockPart].Position
            local CameraPos = Camera.CFrame.Position
            
            -- We use lerp (Linear Interpolation) so it doesn't just "snap" to the floor instantly
            local TargetCFrame = CFrame.new(CameraPos, TargetPos)
            Camera.CFrame = Camera.CFrame:Lerp(TargetCFrame, 1 - Smoothness)
        end
    end

    if SpeedEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.WalkSpeed = WalkSpeedValue
    end
end)
